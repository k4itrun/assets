name: 'Update readme'

on:
 schedule:
  - cron: '0 0 * * *'
 workflow_dispatch:

jobs:
 update-readme:
  runs-on: ubuntu-latest
  env:
   GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  strategy:
   fail-fast: false
   matrix:
    go: ['stable']
  steps:
   - name: Checkout code
     uses: actions/checkout@v4
     with:
      fetch-depth: 1

   - name: Setup Go ${{ matrix.go }}
     uses: actions/setup-go@v5
     with:
      go-version: ${{ matrix.go }}

   - name: Build
     run: go build -o updater main.go

   - name: Generate README.md
     run: ./updater

   - name: Save changes
     run: |
      if [[ "$(git status --porcelain)" != "" ]]; then
        TIMESTAMP=$(date +"%a %b %d %H:%M:%S %Y %z" | tr '[:upper:]' '[:lower:]')
        git config --local user.name k4itrunssh
        git config --local user.email 153697070+k4itrunssh@users.noreply.github.com
        git add -A
        git commit -m "♻️ chore(bot): update readme - updated at: $TIMESTAMP"
        git push --force
      fi
